import{f as b,d as r,o as a,a as t,j as d,i as m,v as f,g as c,t as p}from"./app-iwPyhcQ0.js";import{_ as g}from"./_plugin-vue_export-helper-DlAUqK2U.js";const v={props:["selectedHammock","prices","selectedDate"],data(){return{comment:"",showAuthModal:!1,showGuestForm:!1,guestData:{name:"",email:"",phone:""},pendingReservationType:null,userAuthenticated:!1,user:null}},async mounted(){await this.checkAuthStatus()},methods:{async checkAuthStatus(){try{const s=await b.get("/api/user");this.userAuthenticated=!!s.data,this.user=s.data}catch{this.userAuthenticated=!1,this.user=null}},getAvailability(s){const e=["morning","afternoon","full"],n=s.reservations,u=e.filter(l=>!n.includes(l)),i={morning:"MaÃ±ana",afternoon:"Tarde",full:"DÃ­a Completo"};return n.includes("full")||u.length===0?"No disponible":"Disponible: "+u.map(l=>i[l]).join(", ")},canReserve(s){const e=this.selectedHammock.reservations;return!(e.includes("full")||s==="full"&&(e.includes("morning")||e.includes("afternoon"))||s==="morning"&&e.includes("morning")||s==="afternoon"&&e.includes("afternoon"))},attemptReservation(s){this.userAuthenticated?this.makeReservation(s):(this.pendingReservationType=s,this.showAuthModal=!0)},redirectToLogin(){window.location.href="/login"},continueAsGuest(){this.showAuthModal=!1,this.showGuestForm=!0},confirmGuestReservation(){if(!this.guestData.name||!this.guestData.email||!this.guestData.phone){alert("Todos los campos son obligatorios para continuar como invitado.");return}this.makeReservation(this.pendingReservationType,this.guestData),this.showGuestForm=!1},async makeReservation(s,e=null){try{const n={hammock_id:this.selectedHammock.id,date:this.selectedDate,type:s,time_slot:s,comment:this.comment||"",status:"pending",price:this.prices[s]||0};console.log(n),!this.userAuthenticated&&e?(n.name=e.name,n.email=e.email,n.phone=e.phone):n.user_id=this.user.id,console.log("Enviando reserva con payload:",n);const u=await b.post("/api/bookings",n);console.log("Reserva realizada con Ã©xito:",u.data),this.$emit("refreshGrid"),this.$emit("closeModal")}catch(n){console.error("Error en la reserva:",n)}}}},h={class:"fixed inset-0 flex justify-center items-center bg-black bg-opacity-50"},w={class:"bg-white p-6 rounded-lg shadow-lg w-1/3"},y={class:"mb-4"},x={class:"space-y-2"},k={class:"text-sm font-bold"},R={class:"text-sm font-bold"},A={class:"text-sm font-bold"},C={key:0,class:"fixed inset-0 flex justify-center items-center bg-black bg-opacity-50"},D={class:"bg-white p-6 rounded-lg shadow-lg w-1/3"},T={key:1,class:"fixed inset-0 flex justify-center items-center bg-black bg-opacity-50"},G={class:"bg-white p-6 rounded-lg shadow-lg w-1/3"};function M(s,e,n,u,i,l){return a(),r("div",h,[t("div",w,[e[15]||(e[15]=t("h3",{class:"text-lg font-bold mb-3"},"Reservar Hamaca",-1)),t("div",y,[e[11]||(e[11]=t("label",{for:"comment",class:"block font-semibold"},"Comentario (Opcional):",-1)),m(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=o=>i.comment=o),id:"comment",class:"border p-2 w-full rounded",placeholder:"AÃ±adir comentario..."},null,512),[[f,i.comment]])]),t("div",x,[l.canReserve("morning")?(a(),r("button",{key:0,onClick:e[1]||(e[1]=o=>l.attemptReservation("morning")),class:"bg-yellow-500 text-white px-4 py-2 rounded w-full flex justify-between items-center"},[e[12]||(e[12]=c(" Reservar MaÃ±ana ")),t("span",k,"("+p(n.prices.morning)+"â‚¬)",1)])):d("",!0),l.canReserve("afternoon")?(a(),r("button",{key:1,onClick:e[2]||(e[2]=o=>l.attemptReservation("afternoon")),class:"bg-orange-500 text-white px-4 py-2 rounded w-full flex justify-between items-center"},[e[13]||(e[13]=c(" Reservar Tarde ")),t("span",R,"("+p(n.prices.afternoon)+"â‚¬)",1)])):d("",!0),l.canReserve("full")?(a(),r("button",{key:2,onClick:e[3]||(e[3]=o=>l.attemptReservation("full")),class:"bg-green-500 text-white px-4 py-2 rounded w-full flex justify-between items-center"},[e[14]||(e[14]=c(" Reservar DÃ­a Completo ")),t("span",A,"("+p(n.prices.full)+"â‚¬)",1)])):d("",!0)]),t("button",{onClick:e[4]||(e[4]=o=>s.$emit("closeModal")),class:"mt-4 bg-gray-500 text-white px-4 py-2 rounded w-full"}," Cerrar ")]),i.showAuthModal?(a(),r("div",C,[t("div",D,[e[16]||(e[16]=t("h3",{class:"text-lg font-bold mb-3"},"Â¿Quieres iniciar sesiÃ³n?",-1)),e[17]||(e[17]=t("p",{class:"mb-4"},"Si inicias sesiÃ³n, podrÃ¡s gestionar tus reservas de forma mÃ¡s fÃ¡cil.",-1)),t("button",{onClick:e[5]||(e[5]=(...o)=>l.redirectToLogin&&l.redirectToLogin(...o)),class:"bg-blue-500 text-white px-4 py-2 rounded w-full mb-2"}," ðŸ”‘ Iniciar SesiÃ³n "),t("button",{onClick:e[6]||(e[6]=(...o)=>l.continueAsGuest&&l.continueAsGuest(...o)),class:"bg-gray-500 text-white px-4 py-2 rounded w-full"}," ðŸ‘¤ Continuar como Invitado ")])])):d("",!0),i.showGuestForm?(a(),r("div",T,[t("div",G,[e[18]||(e[18]=t("h3",{class:"text-lg font-bold mb-3"},"Introduce tus datos",-1)),e[19]||(e[19]=t("label",{class:"block font-semibold"},"Nombre:",-1)),m(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>i.guestData.name=o),type:"text",class:"border p-2 w-full rounded mb-2",placeholder:"Tu nombre"},null,512),[[f,i.guestData.name]]),e[20]||(e[20]=t("label",{class:"block font-semibold"},"Correo ElectrÃ³nico:",-1)),m(t("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>i.guestData.email=o),type:"email",class:"border p-2 w-full rounded mb-2",placeholder:"tu@email.com"},null,512),[[f,i.guestData.email]]),e[21]||(e[21]=t("label",{class:"block font-semibold"},"TelÃ©fono:",-1)),m(t("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>i.guestData.phone=o),type:"tel",class:"border p-2 w-full rounded mb-4",placeholder:"NÃºmero de telÃ©fono"},null,512),[[f,i.guestData.phone]]),t("button",{onClick:e[10]||(e[10]=(...o)=>l.confirmGuestReservation&&l.confirmGuestReservation(...o)),class:"bg-green-500 text-white px-4 py-2 rounded w-full"}," Confirmar Reserva ")])])):d("",!0)])}const V=g(v,[["render",M]]);export{V as default};
